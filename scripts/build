#!/bin/bash -e

cd $(dirname $0)/..

source $(dirname $0)/version

go build -ldflags="-w -X github.com/rancher/rancher-compose/version.VERSION=$VERSION" -o bin/rancher-compose

if [ -n "$CROSS" ]; then
    rm -rf build/bin
    mkdir -p build/bin
    gox -os="darwin linux windows" -arch="386 amd64 arm" -output="build/bin/rancher-compose_{{.OS}}-{{.Arch}}" -ldflags="-w -X github.com/rancher/rancher-compose/version.VERSION $VERSION"
fi

if [ ! -e bin/rancher-compose-executor ]; then
    ln -s rancher-compose bin/rancher-compose-executor
fi
